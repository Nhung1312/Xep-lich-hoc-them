<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph·∫ßn m·ªÅm x·∫øp l·ªãch h·ªçc th√™m</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-4">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl shadow-lg p-8 mb-6 text-white">
            <h1 class="text-4xl font-bold text-center mb-3">üìö Ph·∫ßn m·ªÅm x·∫øp l·ªãch h·ªçc th√™m</h1>
            <p class="text-blue-100 text-center text-lg">Ch·ªçn c√°c khung gi·ªù b·∫°n c√≥ th·ªÉ h·ªçc ƒë·ªÉ gi√°o vi√™n x·∫øp l·ªãch ph√π h·ª£p</p>
            <div class="flex justify-center mt-4">
                <div class="bg-white/20 backdrop-blur-sm rounded-lg px-4 py-2">
                    <span class="text-sm font-medium">üéØ H·ªá th·ªëng qu·∫£n l√Ω l·ªãch h·ªçc th√¥ng minh</span>
                </div>
            </div>
        </div>

        <!-- Student Info -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 border-l-4 border-blue-500">
            <div class="flex items-center mb-4">
                <div class="bg-blue-100 p-2 rounded-lg mr-3">
                    <span class="text-2xl">üë§</span>
                </div>
                <h2 class="text-xl font-semibold text-gray-800">Th√¥ng tin h·ªçc sinh</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        <span class="mr-2">üìù</span> H·ªç v√† t√™n
                    </label>
                    <input type="text" id="studentName" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Nh·∫≠p h·ªç t√™n h·ªçc sinh" oninput="saveCurrentStudentInfo()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        <span class="mr-2">üìö</span> M√¥n h·ªçc
                    </label>
                    <select id="subject" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" onchange="saveCurrentStudentInfo()">
                        <option value="">Ch·ªçn m√¥n h·ªçc</option>
                        <option value="To√°n">üìä To√°n</option>
                        <option value="VƒÉn">üìñ Ng·ªØ VƒÉn</option>
                        <option value="Anh">üåç Ti·∫øng Anh</option>
                        <option value="L√Ω">‚ö° V·∫≠t L√Ω</option>
                        <option value="H√≥a">üß™ H√≥a H·ªçc</option>
                        <option value="Sinh">üå± Sinh H·ªçc</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Schedule Grid -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 border-l-4 border-green-500">
            <div class="flex items-center mb-4">
                <div class="bg-green-100 p-2 rounded-lg mr-3">
                    <span class="text-2xl">üìÖ</span>
                </div>
                <h2 class="text-xl font-semibold text-gray-800">Ch·ªçn khung gi·ªù c√≥ th·ªÉ h·ªçc</h2>
            </div>
            <div class="bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-lg mb-6">
                <p class="text-sm text-gray-700 flex items-center">
                    <span class="mr-2">‚úÖ</span> 
                    <strong>H∆∞·ªõng d·∫´n:</strong> Tick v√†o c√°c khung gi·ªù b·∫°n c√≥ th·ªÉ h·ªçc. Gi√°o vi√™n s·∫Ω x·∫øp l·ªãch v√†o c√°c khung gi·ªù c√≤n l·∫°i.
                </p>
                <div class="mt-2 text-xs text-gray-600 flex items-center space-x-4">
                    <span class="flex items-center"><span class="w-3 h-3 bg-blue-100 rounded mr-1"></span>Th·ª© 2-6: Ch·ªâ t·ªëi</span>
                    <span class="flex items-center"><span class="w-3 h-3 bg-purple-100 rounded mr-1"></span>Th·ª© 7-CN: C·∫£ ng√†y</span>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse rounded-lg overflow-hidden shadow-sm">
                    <thead>
                        <tr class="bg-gradient-to-r from-gray-100 to-gray-200">
                            <th class="border border-gray-300 p-4 text-left font-semibold text-gray-800 bg-gray-50">
                                <div class="flex items-center">
                                    <span class="mr-2">‚è∞</span>Th·ªùi gian
                                </div>
                            </th>
                            <th class="border border-gray-300 p-4 text-center font-semibold text-gray-700 bg-blue-50">
                                <div class="flex flex-col items-center">
                                    <span class="text-lg">üìò</span>
                                    <span>Th·ª© 2</span>
                                </div>
                            </th>
                            <th class="border border-gray-300 p-4 text-center font-semibold text-gray-700 bg-blue-50">
                                <div class="flex flex-col items-center">
                                    <span class="text-lg">üìó</span>
                                    <span>Th·ª© 3</span>
                                </div>
                            </th>
                            <th class="border border-gray-300 p-4 text-center font-semibold text-gray-700 bg-blue-50">
                                <div class="flex flex-col items-center">
                                    <span class="text-lg">üìô</span>
                                    <span>Th·ª© 4</span>
                                </div>
                            </th>
                            <th class="border border-gray-300 p-4 text-center font-semibold text-gray-700 bg-blue-50">
                                <div class="flex flex-col items-center">
                                    <span class="text-lg">üìï</span>
                                    <span>Th·ª© 5</span>
                                </div>
                            </th>
                            <th class="border border-gray-300 p-4 text-center font-semibold text-gray-700 bg-blue-50">
                                <div class="flex flex-col items-center">
                                    <span class="text-lg">üìì</span>
                                    <span>Th·ª© 6</span>
                                </div>
                            </th>
                            <th class="border border-gray-300 p-4 text-center font-semibold text-purple-700 bg-purple-50">
                                <div class="flex flex-col items-center">
                                    <span class="text-lg">üéØ</span>
                                    <span>Th·ª© 7</span>
                                </div>
                            </th>
                            <th class="border border-gray-300 p-4 text-center font-semibold text-red-700 bg-red-50">
                                <div class="flex flex-col items-center">
                                    <span class="text-lg">üåü</span>
                                    <span>Ch·ªß nh·∫≠t</span>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="scheduleTable">
                        <!-- Schedule rows will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 border-l-4 border-orange-500">
            <div class="flex items-center mb-4">
                <div class="bg-orange-100 p-2 rounded-lg mr-3">
                    <span class="text-2xl">‚ö°</span>
                </div>
                <h2 class="text-xl font-semibold text-gray-800">Thao t√°c</h2>
            </div>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="submitSchedule()" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-3 px-8 rounded-lg transition duration-300 flex items-center justify-center shadow-lg transform hover:scale-105">
                    <span class="mr-2">üì§</span> G·ª≠i l·ªãch ƒëƒÉng k√Ω
                </button>
                <button onclick="clearAll()" class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-semibold py-3 px-8 rounded-lg transition duration-300 flex items-center justify-center shadow-lg transform hover:scale-105">
                    <span class="mr-2">üóëÔ∏è</span> X√≥a l·ªãch ƒë√£ ch·ªçn
                </button>
                <button onclick="clearStudentInfo()" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-3 px-8 rounded-lg transition duration-300 flex items-center justify-center shadow-lg transform hover:scale-105">
                    <span class="mr-2">üßπ</span> X√≥a th√¥ng tin c√° nh√¢n
                </button>
                <button onclick="showSummary()" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold py-3 px-8 rounded-lg transition duration-300 flex items-center justify-center shadow-lg transform hover:scale-105">
                    <span class="mr-2">üìä</span> Xem t·ªïng k·∫øt
                </button>
            </div>
        </div>

        <!-- Teacher Panel -->
        <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl shadow-lg p-6 mb-6 text-white">
            <div class="flex items-center mb-6">
                <div class="bg-white/20 backdrop-blur-sm p-3 rounded-lg mr-4">
                    <span class="text-3xl">üë®‚Äçüè´</span>
                </div>
                <div>
                    <h2 class="text-2xl font-bold">B·∫£ng ƒëi·ªÅu khi·ªÉn gi√°o vi√™n</h2>
                    <p class="text-purple-100 text-sm">Qu·∫£n l√Ω v√† ph√¢n t√≠ch l·ªãch h·ªçc c·ªßa t·∫•t c·∫£ h·ªçc sinh</p>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="showAllStudents()" class="bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center shadow-lg transform hover:scale-105 border border-white/30">
                    <span class="mr-2">üë•</span> Xem t·∫•t c·∫£ h·ªçc sinh
                </button>
                <button onclick="findCommonSlots()" class="bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center shadow-lg transform hover:scale-105 border border-white/30">
                    <span class="mr-2">üéØ</span> T√¨m gi·ªù chung cho t·∫•t c·∫£
                </button>
                <button onclick="clearStudentData()" class="bg-red-500/80 hover:bg-red-600/80 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center shadow-lg transform hover:scale-105 border border-red-300/50">
                    <span class="mr-2">üóëÔ∏è</span> X√≥a d·ªØ li·ªáu h·ªçc sinh
                </button>
            </div>
        </div>

        <!-- All Students Summary -->
        <div id="allStudentsSection" class="bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üë• Danh s√°ch t·∫•t c·∫£ h·ªçc sinh ƒë√£ ƒëƒÉng k√Ω</h2>
            <div id="allStudentsContent"></div>
        </div>

        <!-- Common Slots -->
        <div id="commonSlotsSection" class="bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üéØ Khung gi·ªù chung cho t·∫•t c·∫£ h·ªçc sinh</h2>
            <div id="commonSlotsContent"></div>
        </div>

        <!-- Summary -->
        <div id="summarySection" class="bg-white rounded-xl shadow-lg p-6 hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üìã T·ªïng k·∫øt l·ªãch ƒëƒÉng k√Ω</h2>
            <div id="summaryContent"></div>
        </div>
    </div>

    <script>
        // Define time slots for different days (sorted from morning to evening)
        const timeSlots = {
            weekdays: ['19:00 - 21:00'], // Monday to Friday
            weekends: ['07:00 - 09:00', '09:15 - 11:15', '14:00 - 16:00', '19:00 - 21:00'] // Saturday and Sunday
        };

        // All time slots in chronological order
        const allTimeSlotsOrdered = ['07:00 - 09:00', '09:15 - 11:15', '14:00 - 16:00', '19:00 - 21:00'];

        const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
        const dayNames = ['Th·ª© 2', 'Th·ª© 3', 'Th·ª© 4', 'Th·ª© 5', 'Th·ª© 6', 'Th·ª© 7', 'Ch·ªß nh·∫≠t'];
        
        // Store all student data
        let allStudentsData = JSON.parse(localStorage.getItem('studentsSchedule') || '[]');
        
        // Load saved student info
        function loadSavedStudentInfo() {
            const savedInfo = JSON.parse(localStorage.getItem('currentStudentInfo') || '{}');
            if (savedInfo.name) {
                document.getElementById('studentName').value = savedInfo.name;
            }
            if (savedInfo.subject) {
                document.getElementById('subject').value = savedInfo.subject;
            }
        }

        // Save current student info
        function saveCurrentStudentInfo() {
            const studentName = document.getElementById('studentName').value;
            const subject = document.getElementById('subject').value;
            
            if (studentName || subject) {
                const studentInfo = {
                    name: studentName,
                    subject: subject
                };
                localStorage.setItem('currentStudentInfo', JSON.stringify(studentInfo));
            }
        }

        // Generate schedule table
        function generateScheduleTable() {
            const tableBody = document.getElementById('scheduleTable');
            
            // Use ordered time slots from morning to evening
            allTimeSlotsOrdered.forEach((timeSlot, index) => {
                const row = document.createElement('tr');
                const timeIcon = index === 0 ? 'üåÖ' : index === 1 ? '‚òÄÔ∏è' : index === 2 ? 'üåá' : 'üåô';
                const rowBg = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                
                row.className = `${rowBg} hover:bg-blue-50 transition duration-200`;
                row.innerHTML = `
                    <td class="border border-gray-300 p-4 font-semibold text-gray-800 bg-gradient-to-r from-gray-50 to-gray-100">
                        <div class="flex items-center">
                            <span class="mr-2 text-lg">${timeIcon}</span>
                            <span>${timeSlot}</span>
                        </div>
                    </td>
                    ${days.map((day, dayIndex) => {
                        const isWeekend = dayIndex >= 5;
                        const availableSlots = isWeekend ? timeSlots.weekends : timeSlots.weekdays;
                        const isAvailable = availableSlots.includes(timeSlot);
                        
                        if (isAvailable) {
                            const cellBg = isWeekend ? 'bg-purple-50 hover:bg-purple-100' : 'bg-blue-50 hover:bg-blue-100';
                            return `<td class="border border-gray-300 p-4 text-center ${cellBg} transition duration-200">
                                <input type="checkbox" id="${day}_${timeSlot}" class="w-6 h-6 text-blue-600 rounded-md focus:ring-2 focus:ring-blue-500 cursor-pointer transform hover:scale-110 transition duration-200" onchange="updateSelection()">
                            </td>`;
                        } else {
                            return `<td class="border border-gray-300 p-4 text-center bg-gray-100">
                                <span class="text-gray-400 text-sm font-medium">‚ùå Kh√¥ng c√≥ l·ªãch</span>
                            </td>`;
                        }
                    }).join('')}
                `;
                tableBody.appendChild(row);
            });
        }

        // Update selection counter
        function updateSelection() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            console.log(`ƒê√£ ch·ªçn ${checkboxes.length} khung gi·ªù`);
        }

        // Clear all selections
        function clearAll() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => checkbox.checked = false);
            document.getElementById('summarySection').classList.add('hidden');
            updateSelection();
        }

        // Clear student info
        function clearStudentInfo() {
            if (confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a th√¥ng tin c√° nh√¢n ƒë√£ l∆∞u?')) {
                document.getElementById('studentName').value = '';
                document.getElementById('subject').value = '';
                localStorage.removeItem('currentStudentInfo');
                alert('‚úÖ ƒê√£ x√≥a th√¥ng tin c√° nh√¢n!');
            }
        }

        // Submit schedule
        function submitSchedule() {
            const studentName = document.getElementById('studentName').value;
            const subject = document.getElementById('subject').value;
            
            if (!studentName || !subject) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin h·ªçc sinh v√† m√¥n h·ªçc!');
                return;
            }

            const selectedSlots = [];
            const availableSlots = [];
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            
            // Get selected (unavailable) slots
            checkboxes.forEach(checkbox => {
                const [day, time] = checkbox.id.split('_');
                const dayIndex = days.indexOf(day);
                selectedSlots.push({
                    day: dayNames[dayIndex],
                    time: time,
                    dayCode: day
                });
            });

            // Get available slots
            days.forEach((day, index) => {
                const isWeekend = index >= 5;
                const daySlots = isWeekend ? timeSlots.weekends : timeSlots.weekdays;
                
                daySlots.forEach(timeSlot => {
                    const checkbox = document.getElementById(`${day}_${timeSlot}`);
                    if (checkbox && !checkbox.checked) {
                        availableSlots.push({
                            day: dayNames[index],
                            time: timeSlot,
                            dayCode: day
                        });
                    }
                });
            });

            // Save student data
            const studentData = {
                id: Date.now(),
                name: studentName,
                subject: subject,
                unavailableSlots: selectedSlots,
                availableSlots: availableSlots,
                submittedAt: new Date().toLocaleString('vi-VN')
            };

            // Check if student already exists (by name and subject)
            const existingIndex = allStudentsData.findIndex(s => s.name === studentName && s.subject === subject);
            if (existingIndex >= 0) {
                allStudentsData[existingIndex] = studentData;
                alert(`‚úÖ ƒê√£ c·∫≠p nh·∫≠t l·ªãch cho ${studentName}!`);
            } else {
                allStudentsData.push(studentData);
                alert(`‚úÖ ƒê√£ th√™m l·ªãch cho ${studentName}!`);
            }

            // Save to localStorage
            localStorage.setItem('studentsSchedule', JSON.stringify(allStudentsData));

            alert(`üìä Th√¥ng tin ƒë√£ l∆∞u:\n\nH·ªçc sinh: ${studentName}\nM√¥n: ${subject}\nKhung gi·ªù c√≥ th·ªÉ h·ªçc: ${availableSlots.length}\nT·ªïng s·ªë h·ªçc sinh ƒë√£ ƒëƒÉng k√Ω: ${allStudentsData.length}\n\nB·∫°n c√≥ th·ªÉ d√πng "B·∫£ng ƒëi·ªÅu khi·ªÉn gi√°o vi√™n" ƒë·ªÉ xem t·ªïng h·ª£p!`);
            
            showSummary();
        }

        // Show summary
        function showSummary() {
            const studentName = document.getElementById('studentName').value || 'Ch∆∞a nh·∫≠p';
            const subject = document.getElementById('subject').value || 'Ch∆∞a ch·ªçn';
            const selectedSlots = [];
            const availableSlots = [];
            
            // Get selected slots
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                const [day, time] = checkbox.id.split('_');
                const dayIndex = days.indexOf(day);
                selectedSlots.push({
                    day: dayNames[dayIndex],
                    time: time
                });
            });

            // Get available slots (not selected)
            days.forEach((day, index) => {
                const isWeekend = index >= 5;
                const daySlots = isWeekend ? timeSlots.weekends : timeSlots.weekdays;
                
                daySlots.forEach(timeSlot => {
                    const checkbox = document.getElementById(`${day}_${timeSlot}`);
                    if (checkbox && !checkbox.checked) {
                        availableSlots.push({
                            day: dayNames[index],
                            time: timeSlot
                        });
                    }
                });
            });

            const summaryContent = document.getElementById('summaryContent');
            summaryContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-blue-800 mb-2">üìù Th√¥ng tin h·ªçc sinh</h3>
                        <p><strong>H·ªç t√™n:</strong> ${studentName}</p>
                        <p><strong>M√¥n h·ªçc:</strong> ${subject}</p>
                    </div>
                    
                    <div class="bg-red-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-red-800 mb-2">‚ùå Khung gi·ªù KH√îNG th·ªÉ h·ªçc (${selectedSlots.length})</h3>
                        ${selectedSlots.length > 0 ? 
                            selectedSlots.map(slot => `<p class="text-sm">‚Ä¢ ${slot.day}: ${slot.time}</p>`).join('') :
                            '<p class="text-sm text-gray-600">Kh√¥ng c√≥ khung gi·ªù n√†o ƒë∆∞·ª£c ch·ªçn</p>'
                        }
                    </div>
                </div>
                
                <div class="mt-6 bg-green-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-green-800 mb-2">‚úÖ Khung gi·ªù C√ì TH·ªÇ x·∫øp l·ªãch h·ªçc (${availableSlots.length})</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                        ${availableSlots.length > 0 ? 
                            availableSlots.map(slot => `<p class="text-sm bg-white p-2 rounded border">üìÖ ${slot.day}: ${slot.time}</p>`).join('') :
                            '<p class="text-sm text-gray-600">Kh√¥ng c√≥ khung gi·ªù n√†o c√≥ th·ªÉ x·∫øp l·ªãch</p>'
                        }
                    </div>
                </div>
            `;
            
            document.getElementById('summarySection').classList.remove('hidden');
        }

        // Show all students
        function showAllStudents() {
            if (allStudentsData.length === 0) {
                alert('Ch∆∞a c√≥ h·ªçc sinh n√†o ƒëƒÉng k√Ω!');
                return;
            }

            const content = document.getElementById('allStudentsContent');
            content.innerHTML = `
                <div class="mb-4 text-sm text-gray-600">
                    T·ªïng s·ªë h·ªçc sinh ƒë√£ ƒëƒÉng k√Ω: <strong>${allStudentsData.length}</strong>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${allStudentsData.map(student => `
                        <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                            <h4 class="font-semibold text-gray-800">${student.name}</h4>
                            <p class="text-sm text-gray-600">M√¥n: ${student.subject}</p>
                            <p class="text-sm text-gray-600">ƒêƒÉng k√Ω: ${student.submittedAt}</p>
                            <p class="text-sm text-green-600 mt-2">‚úÖ C√≥ th·ªÉ h·ªçc: ${student.availableSlots.length} khung gi·ªù</p>
                            <p class="text-sm text-red-600">‚ùå Kh√¥ng th·ªÉ: ${student.unavailableSlots.length} khung gi·ªù</p>
                            <button onclick="showStudentDetail(${student.id})" class="mt-2 text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600">
                                Xem chi ti·∫øt
                            </button>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('allStudentsSection').classList.remove('hidden');
        }

        // Show student detail
        function showStudentDetail(studentId) {
            const student = allStudentsData.find(s => s.id === studentId);
            if (!student) return;

            const availableList = student.availableSlots.map(slot => `‚Ä¢ ${slot.day}: ${slot.time}`).join('\n');
            const unavailableList = student.unavailableSlots.map(slot => `‚Ä¢ ${slot.day}: ${slot.time}`).join('\n');

            alert(`üìã Chi ti·∫øt l·ªãch h·ªçc - ${student.name}\n\n` +
                  `M√¥n h·ªçc: ${student.subject}\n` +
                  `ƒêƒÉng k√Ω l√∫c: ${student.submittedAt}\n\n` +
                  `‚úÖ C√ì TH·ªÇ H·ªåC (${student.availableSlots.length} khung):\n${availableList || 'Kh√¥ng c√≥'}\n\n` +
                  `‚ùå KH√îNG TH·ªÇ H·ªåC (${student.unavailableSlots.length} khung):\n${unavailableList || 'Kh√¥ng c√≥'}`);
        }

        // Find common available slots for all students
        function findCommonSlots() {
            if (allStudentsData.length === 0) {
                alert('Ch∆∞a c√≥ h·ªçc sinh n√†o ƒëƒÉng k√Ω!');
                return;
            }

            // Get all possible time slots
            const allPossibleSlots = [];
            days.forEach((day, index) => {
                const isWeekend = index >= 5;
                const daySlots = isWeekend ? timeSlots.weekends : timeSlots.weekdays;
                
                daySlots.forEach(timeSlot => {
                    allPossibleSlots.push({
                        day: dayNames[index],
                        time: timeSlot,
                        dayCode: day,
                        key: `${day}_${timeSlot}`
                    });
                });
            });

            // Find slots that are available for ALL students
            const commonSlots = allPossibleSlots.filter(slot => {
                return allStudentsData.every(student => {
                    return student.availableSlots.some(availableSlot => 
                        availableSlot.dayCode === slot.dayCode && availableSlot.time === slot.time
                    );
                });
            });

            // Find slots available for each individual student count
            const slotAnalysis = allPossibleSlots.map(slot => {
                const availableStudents = allStudentsData.filter(student => {
                    return student.availableSlots.some(availableSlot => 
                        availableSlot.dayCode === slot.dayCode && availableSlot.time === slot.time
                    );
                });

                return {
                    ...slot,
                    availableCount: availableStudents.length,
                    availableStudents: availableStudents.map(s => s.name),
                    percentage: Math.round((availableStudents.length / allStudentsData.length) * 100)
                };
            }).sort((a, b) => b.availableCount - a.availableCount);

            const content = document.getElementById('commonSlotsContent');
            content.innerHTML = `
                <div class="mb-6">
                    <div class="bg-green-100 border border-green-300 rounded-lg p-4 mb-4">
                        <h3 class="font-semibold text-green-800 mb-2">üéØ Khung gi·ªù T·∫§T C·∫¢ h·ªçc sinh ƒë·ªÅu c√≥ th·ªÉ h·ªçc (${commonSlots.length} khung)</h3>
                        ${commonSlots.length > 0 ? 
                            `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                                ${commonSlots.map(slot => 
                                    `<div class="bg-white p-3 rounded border border-green-200">
                                        <div class="font-medium text-green-700">üìÖ ${slot.day}</div>
                                        <div class="text-sm text-green-600">‚è∞ ${slot.time}</div>
                                        <div class="text-xs text-green-500 mt-1">‚úÖ ${allStudentsData.length}/${allStudentsData.length} h·ªçc sinh</div>
                                    </div>`
                                ).join('')}
                            </div>` :
                            '<p class="text-gray-600">‚ùå Kh√¥ng c√≥ khung gi·ªù n√†o t·∫•t c·∫£ h·ªçc sinh ƒë·ªÅu r·∫£nh</p>'
                        }
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="font-semibold text-blue-800 mb-3">üìä Ph√¢n t√≠ch chi ti·∫øt t·ª´ng khung gi·ªù</h3>
                        <div class="space-y-3">
                            ${slotAnalysis.map(slot => `
                                <div class="bg-white p-3 rounded border ${slot.percentage === 100 ? 'border-green-300' : slot.percentage >= 70 ? 'border-yellow-300' : 'border-red-300'}">
                                    <div class="flex justify-between items-start mb-2">
                                        <div>
                                            <span class="font-medium">${slot.day} - ${slot.time}</span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-sm font-semibold ${slot.percentage === 100 ? 'text-green-600' : slot.percentage >= 70 ? 'text-yellow-600' : 'text-red-600'}">
                                                ${slot.availableCount}/${allStudentsData.length} (${slot.percentage}%)
                                            </span>
                                        </div>
                                    </div>
                                    <div class="text-xs text-gray-600">
                                        <strong>C√≥ th·ªÉ h·ªçc:</strong> ${slot.availableStudents.join(', ') || 'Kh√¥ng c√≥ ai'}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('commonSlotsSection').classList.remove('hidden');

            // Show summary alert
            if (commonSlots.length > 0) {
                alert(`üéØ T√¨m th·∫•y ${commonSlots.length} khung gi·ªù T·∫§T C·∫¢ ${allStudentsData.length} h·ªçc sinh ƒë·ªÅu c√≥ th·ªÉ h·ªçc!\n\n` +
                      commonSlots.map(slot => `üìÖ ${slot.day}: ${slot.time}`).join('\n') +
                      '\n\nXem chi ti·∫øt b√™n d∆∞·ªõi ƒë·ªÉ bi·∫øt th√™m th√¥ng tin!');
            } else {
                alert(`‚ùå Kh√¥ng c√≥ khung gi·ªù n√†o t·∫•t c·∫£ ${allStudentsData.length} h·ªçc sinh ƒë·ªÅu r·∫£nh.\n\nXem ph√¢n t√≠ch chi ti·∫øt b√™n d∆∞·ªõi ƒë·ªÉ t√¨m khung gi·ªù ph√π h·ª£p nh·∫•t!`);
            }
        }

        // Clear all student data
        function clearStudentData() {
            if (confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ d·ªØ li·ªáu h·ªçc sinh? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) {
                allStudentsData = [];
                localStorage.removeItem('studentsSchedule');
                document.getElementById('allStudentsSection').classList.add('hidden');
                document.getElementById('commonSlotsSection').classList.add('hidden');
                alert('‚úÖ ƒê√£ x√≥a t·∫•t c·∫£ d·ªØ li·ªáu h·ªçc sinh!');
            }
        }

        // Initialize the schedule table when page loads
        document.addEventListener('DOMContentLoaded', function() {
            generateScheduleTable();
            loadSavedStudentInfo(); // Load saved student info
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97aa8612d5279b44',t:'MTc1NzEyNTYwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
